!function($,win){"use strict";function Slider($el,options){options=options||{},this.options={lazyload:options.lazyload||!1,attribute:options.attribute||"data-src",autoplay:options.autoplay||!1,interval:options.interval||3e3,index:options.index||0,duration:options.duration||400,easing:options.easing||"ease",vertical:options.vertical||!1},this.$el=$el,this.index=this.options.index,this.items=this.$el.children(),this.eventName="onorientationchange"in win?"orientationchange":"resize.slider"+nsid++,this._init()}var VERSION="0.2.0",nsid=0,$win=$(win),cssPrefix=$.fx.cssPrefix,transitionEnd=$.fx.transitionEnd,_slice=Array.prototype.slice;Slider.prototype={constructor:Slider,_init:function(){this.container=document.createElement("div"),this.container.className="slider-container",this.items.wrapAll(this.container),this.position={x:0,y:0},this.items.length<2?this._loadImage():(this.$el.on("touchstart",this._handler.start.bind(this)),$win.on(this.eventName,this.refresh.bind(this)),this.options.autoplay&&this._play()),this.refresh()},_handler:{start:function(e){if(e.touches.length>1)return!1;var touch=e.touches[0],handler=this._handler;this._stop(),this.start={x:touch.pageX,y:touch.pageY,time:Date.now()},this.offset={x:0,y:0},this.changed=!1,this.$el.on({touchmove:handler.move.bind(this),touchend:handler.end.bind(this),touchcancel:handler.end.bind(this)}),this.$el.trigger("dragstart",{index:this.getIndex(),items:this.items})},move:function(e){if(e.touches.length>1)return!1;var touch=e.touches[0],start=this.start,offset=this.offset,position=this.position,rightMoved=this.options.vertical?touch.pageY>start.y:touch.pageX>start.x;if(offset.x=touch.pageX-start.x,offset.y=touch.pageY-start.y,this.prevRightMoved!==rightMoved||!this.dragging){var dir=this._direction();this._updateItemPos(this.index+dir);var idx=this.getIndex();this.$el.trigger("drag",{dir:dir,index:idx,items:this.items})}this.dragging||(this.dragging=!0),this._translate({x:position.x+offset.x,y:position.y+offset.y}),this.prevRightMoved=rightMoved,e.preventDefault()},end:function(e){this.$el.off("touchmove touchend touchcancel");var changed=!1,offset=this.offset,absMoveX=Math.abs(offset.x),absMoveY=Math.abs(offset.y),slideTime=Date.now()-this.start.time,dir=0,vertical=this.options.vertical;changed=200>slideTime?vertical?absMoveY>30:absMoveX>30:!!Math.round(vertical?absMoveY/this.height:absMoveX/this.width),changed&&(dir=this._direction(),this.index+=dir);var idx=this.getIndex();this.$el.trigger("dragend",{dir:dir,index:idx,items:this.items}),this._toIndex(this.index),this.dragging=!1}},_translate:function(opts,callback){var el=this.container,options=this.options,easing=options.easing,duration=opts.duration||0,x=0,y=0;if(options.vertical?y=opts.y||0:x=opts.x||0,duration>0){var fn=function(){el.removeEventListener(transitionEnd,fn,!1),callback&&callback.call(this)};el.addEventListener(transitionEnd,fn,!1)}el.style.cssText=cssPrefix+"transition: "+cssPrefix+"transform "+duration+"ms "+easing+";"+cssPrefix+"transform: translate3d("+x+"px,"+y+"px,0)"},_direction:function(){var offset=this.offset,movingPoint=this.options.vertical?offset.y:offset.x;return movingPoint>0?-1:0>movingPoint?1:0},_updateItemPos:function(idx){var items=this.items,item=items.eq(idx%items.length);this.options.vertical?item.css("top",this.height*idx):item.css("left",this.width*idx)},_play:function(){var that=this,opts=this.options;clearTimeout(this.timer),this.timer=setTimeout(function __inner(){that.index+=1,that._updateItemPos(that.index),that._toIndex(that.index),that.timer=setTimeout(__inner,opts.interval)},opts.interval)},_stop:function(){null!=this.timer&&(clearTimeout(this.timer),this.timer=null)},_toIndex:function(index,duration){var opts=this.options;null==duration&&(duration=opts.duration),this.position={x:parseInt(-(this.width*index),10),y:parseInt(-(this.height*index),10)},opts.lazyload&&this._loadImage(),this._translate({x:this.position.x,y:this.position.y,duration:duration},function(){opts.autoplay&&this._play()}.bind(this))},_loadImage:function(){var opts=this.options,$item=this.items.eq(this.getIndex()),loaded=$item.data("loaded");if(!loaded){var $img=$item.find("img["+opts.attribute+"]");$img.prop("src",$img.attr(opts.attribute)),$item.data("loaded",!0)}},refresh:function(){var vertical=this.options.vertical,width=this.width=this.$el.width(),height=this.height=this.$el.height(),properties={position:"absolute",overflow:"hidden"};this.index=this.index%this.items.length,this._toIndex(this.index,0),vertical?(properties.height=height,this.items.each(function(index,item){properties.top=index*height,$(item).css(properties)})):(properties.width=width,this.items.each(function(index,item){properties.left=index*width,$(item).css(properties)}))},slideTo:function(to){var max=this.items.length;0>to&&(to=0),to>=max&&(to=max-1),this.index=to,this.refresh(),this._toIndex(to)},getIndex:function(){var length=this.items.length;return Math.abs((this.index+length)%length)},destroy:function(){this.$el.removeData("__slider__").off(),$win.off(this.eventName)}};var _slider=$.fn.slider=function(options){var args=arguments;if(0===args.length||$.isPlainObject(options)&&1===args.length)$.each(this,function(index,item){var $item=$(item);$item.data("__slider__",new Slider($item,options))});else if("option"===options&&args.length>1){var ret=[];return $.each(this,function(){var slider=$(this).data("__slider__"),method=null;if(slider){if(method=slider[args[1]],!(method&&args[1].indexOf("_")<0&&$.isFunction(method)))throw new Error(args[1]+" method does not exist.");var result=method.apply(slider,_slice.call(args,2));null!=result&&ret.push(result)}}),ret.pop()}return this};_slider.version=VERSION}(Zepto,window);