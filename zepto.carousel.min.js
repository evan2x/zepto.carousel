!function(factory,root){"function"==typeof define&&define.amd?define(["zepto"],function(zepto){factory(zepto,root)}):"object"==typeof module&&module.exports?module.exports=factory(require("zepto"),root):root.carousel=factory(Zepto,root)}(function($,root){"use strict";function Carousel($el,options){options=options||{},this.options={lazyload:options.lazyload||!1,attribute:options.attribute||"data-src",autoplay:options.autoplay||!1,interval:options.interval||3e3,index:options.index||0,duration:options.duration||400,easing:options.easing||"ease",vertical:options.vertical||!1,loop:"boolean"==typeof options.loop?options.loop:!0},this.$el=$el,this.width=$el.width(),this.height=$el.height(),this.realIndex=this.prevIndex=this.options.index,this.items=this.$el.children(),this.length=this.items.length,this.records={x:0,y:0},this._init()}var $win=$(root),cssPrefix=$.fx.cssPrefix,transitionEnd=$.fx.transitionEnd,eventType="onorientationchange"in root?"orientationchange":"resize",core_slice=Array.prototype.slice,offset2dir=function(n){return n>0?-1:0>n?1:0===n?0:void 0},attenuate=function(n){return 0>n?-Math.sqrt(Math.abs(n)):Math.sqrt(n)};Carousel.prototype={constructor:Carousel,get index(){var n=this.realIndex%this.length;return 0>n&&(n+=this.length),n},_init:function(){this.container=document.createElement("div"),this.container.className="carousel-container",this.items.wrapAll(this.container),this.length<2?this._imageLoad():(this.$el.on("touchstart",this._startHandler.bind(this)),$win.on(eventType,this.refresh.bind(this)),$win.on("touchmove",function(e){this.$el.has(e.target).length&&e.preventDefault()}.bind(this)),this.options.autoplay&&this.play()),this.refresh()},_translate:function(options,callback){options=options||{};var el=this.container,duration=options.duration||0,easing=options.easing||this.options.easing,y=options.y||0,x=options.x||0;if(duration>0){el.style[cssPrefix+"transition"]=cssPrefix+"transform "+duration+"ms "+easing;var fn=function(){el.style[cssPrefix+"transition"]=cssPrefix+"transform 0ms "+easing,el.removeEventListener(transitionEnd,fn,!1),$.isFunction(callback)&&callback.call(this)};el.addEventListener(transitionEnd,fn,!1)}el.style[cssPrefix+"transform"]="translate3d("+x+"px,"+y+"px,0)"},_imageLoad:function(){var options=this.options,$item=this.items.eq(this.index),loaded=$item.data("loaded");if(!loaded){var $img=$item.find("img["+options.attribute+"]");$img.prop("src",$img.attr(options.attribute)),$item.data("loaded",!0)}},_toIndex:function(index,duration){var that=this,options=this.options,x=0,y=0;null==duration&&(duration=options.duration),options.vertical?y=this.records.y=parseInt(-this.height*index,10):x=this.records.x=parseInt(-this.width*index,10),options.lazyload&&this._imageLoad(),this.prevIndex!=index&&(this.prevIndex=index,that.$el.trigger("change",{index:that.index,items:that.items})),this._translate({x:x,y:y,duration:duration},function(){options.autoplay&&that.play()})},_positionForItemUpdate:function(index){var item=this.items.eq(index%this.length),x=0,y=0;this.options.vertical?y=this.height*index:x=this.width*index,item.css(cssPrefix+"transform","translate3d("+x+"px,"+y+"px,0)")},_startHandler:function(e){if(e.touches.length>1)return!1;var touch=e.touches[0];this.start={x:touch.pageX,y:touch.pageY,time:Date.now()},this.offset={x:0,y:0},this.$el.on({touchmove:this._moveHandler.bind(this),touchend:this._endHandler.bind(this),touchcancel:this._endHandler.bind(this)}),this.$el.trigger("dragstart",{index:this.index,items:this.items})},_moveHandler:function(e){if(e.touches.length>1)return!1;var touch=e.touches[0],loop=this.options.loop,vertical=this.options.vertical,start=this.start,offset=this.offset,records=this.records,min=0,max=this.length-1,x=0,y=0,forward=!1,direction=0;vertical?(offset.y=touch.pageY-start.y,forward=touch.pageY>start.y,direction=offset2dir(offset.y)):(offset.x=touch.pageX-start.x,forward=touch.pageX>start.x,direction=offset2dir(offset.x)),loop||this.index!==min||-1!==direction||(vertical?offset.y=attenuate(offset.y):offset.x=attenuate(offset.x)),loop||this.index!==max||1!==direction||(vertical?offset.y=attenuate(offset.y):offset.x=attenuate(offset.x)),this.forward===forward&&this.dragging||(loop&&this._positionForItemUpdate(this.realIndex+direction),this.$el.trigger("drag",{direction:direction,index:this.index,items:this.items})),vertical?y=records.y+offset.y:x=records.x+offset.x,this._translate({x:x,y:y}),this.forward=forward,this.dragging=!0},_endHandler:function(){this.$el.off("touchmove touchend touchcancel");var vertical=this.options.vertical,loop=this.options.loop,offset=this.offset,moveX=Math.abs(offset.x),moveY=Math.abs(offset.y),direction=0;if(vertical&&moveY>0||!vertical&&moveX>0){var changed=!1,min=0,max=this.length-1,timeDiff=Date.now()-this.start.time;direction=offset2dir(vertical?offset.y:offset.x),loop||this.index!==min||-1!==direction?loop||this.index!==max||1!==direction?(changed=200>timeDiff?vertical?moveY>30:moveX>30:!!Math.round(vertical?moveY/this.height:moveX/this.width),changed&&(this.realIndex+=direction)):this.realIndex=max:this.realIndex=min,this._toIndex(this.realIndex)}this.$el.trigger("dragend",{direction:direction,index:this.index,items:this.items}),this.dragging=!1},play:function(){var that=this,options=this.options;clearTimeout(this.timer),this.timer=setTimeout(function __inner(){that.realIndex+=1,that._positionForItemUpdate(that.realIndex),that._toIndex(that.realIndex),that.timer=setTimeout(__inner,options.interval)},options.interval)},stop:function(){null!=this.timer&&(clearTimeout(this.timer),this.timer=null)},getIndex:function(){return this.index},getItems:function(){return this.items},refresh:function(){var vertical=this.options.vertical,width=this.$el.width(),height=this.$el.height(),x=0,y=0,properties={position:"absolute",overflow:"hidden"};this.width=width,this.height=height,this.realIndex=this.index,this._toIndex(this.realIndex,0),this.items.each(function(index,item){vertical?(properties.height=height,y=index*height):(properties.width=width,x=index*width),properties[cssPrefix+"transform"]="translate3d("+x+"px,"+y+"px, 0)",$(item).css(properties).show()})},slideTo:function(index){var that=this,max=this.length;0>index&&(index=0),index>=max&&(index=max-1),this.refresh(),this.realIndex=index,that._toIndex(index)},destroy:function(){this.$el.removeData("__carousel__").off(),$win.off(eventType)}};var _carousel=$.fn.carousel=function(options){var args=arguments;if(0===args.length||$.isPlainObject(options)&&1===args.length)$.each(this,function(index,item){var $item=$(item);$item.data("__carousel__",new Carousel($item,options))});else if(args.length>=1&&"string"==typeof options){var ret=[];return $.each(this,function(){var carousel=$(this).data("__carousel__");if(carousel){var method=options;if(!method||-1!==method.indexOf("_")||!$.isFunction(carousel[method]))throw new Error(method+" method does not exist.");ret.push(carousel[method].apply(carousel,core_slice.call(args,1)))}}),ret.pop()}return this};_carousel.version="1.1.0"},window);